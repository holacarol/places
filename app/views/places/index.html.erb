<%= javascript_tag do %>
  $(function() {
    SocialStream.Objects.init();
  });
<% end %>

<%= javascript_tag do %>
  $(document).ready(function(){
    $('a#my_button').click(function(){
      if ($(this).hasClass('on')) {
        $(this).toggleClass("on off");
        $('a#friends_button').attr('class', 'on');
        $('a#recommended_button').attr('class', 'on');

        $('#places').toggleClass("hidden", false);
        $('#friends').toggleClass("hidden", true);
      }
    });
    $('a#friends_button').click(function(){
      if ($(this).hasClass('on')) {
        $(this).toggleClass("on off");
        $('a#my_button').attr('class', 'on');
        $('a#recommended_button').attr('class', 'on');

        $('#places').toggleClass("hidden", true);
        $('#friends').toggleClass("hidden", false);
      }
    });
    $('a#recommended_button').click(function(){
      if ($(this).hasClass('on')) {
        $(this).toggleClass("on off");
        $('a#my_button').attr('class', 'on');
        $('a#friends_button').attr('class', 'on');
      }
    });
  });
<% end %>

<%= javascript_tag do %>
  $(document).ready(function(){
    $('a#list_view').click(function(){
      if ($(this).hasClass('view_unselected')) {
        $(this).toggleClass("view_unselected view_selected");
        $('a#map_view').toggleClass("view_unselected view_selected");
        
        var $marginLefty = $('.roll');
        $marginLefty.animate({
          marginLeft: parseInt($marginLefty.css('marginLeft'),10) == 0 ?
            -$marginLefty.outerWidth()/2 :
            0
        });
      }
    });
    $('a#map_view').click(function(){
      if ($(this).hasClass('view_unselected')) {
        $(this).toggleClass("view_unselected view_selected");
        $('a#list_view').toggleClass("view_unselected view_selected");

        var $marginLefty = $('.roll');
        $marginLefty.animate({
          marginLeft: parseInt($marginLefty.css('marginLeft'),10) == 0 ?
            -$marginLefty.outerWidth()/2 :
            0
        });
      }
    });
  });
<% end %>

<% content_for :title do %>
<%= profile_subject.name + ": " + t('place.title') %>
<% end %>

<% sidebar %>

<% toolbar :profile, :subject => profile_subject %>

<%if profile_subject_is_current?%>
<%= location(
  link_to(t('place.title') + ' ' + t('place.like.me'), polymorphic_path(controller.controller_name),:remote => true)
  ) %>
<%else%>
<%= location(
  link_to(profile_subject.name, polymorphic_path(profile_subject),:remote => true),
  link_to(t('place.title') + ' ' + t('place.like.other', :contact => profile_subject.name), polymorphic_path([profile_subject, controller.controller_name]),:remote => true)
  ) %>
<%end%>

<br class="clearfloat" />
<div class="space_center"></div>


<div class="place_list_more">
  <div class="place_list_map">
    <a id="my_button" class="off" title="button">My places</a>
    <a id="friends_button" class="on" title="button">Friends places</a>
    <a id="recommended_button" class="on" title="button">Recommended</a>
  </div>
  <div class ="place_list_add">
      <%= render :partial => 'places/search' %>
  </div>
</div>

<br class="clearfloat" />
<div class="space_center"></div>

<div class="place_card_see">
  <div class="place_card_see_text">
    <%= link_to t("place.view.list"), "#", :id => "list_view", :class => "view_selected" %>
     | 
    <%= link_to t("place.view.map"), "#", :id => "map_view", :class => "view_unselected" %>
  </div>
</div>

<div id="places_container">
  <div id="places" class="roll">
    <div id="place_list">
      <% unless @activities.empty? %>
        <% @activities.each do |a| %>
          <% place = a.activity_objects.first.place %>
          
          <%= div_for place do %>
              <div class="place_list_item">
                <%= image_tag("place.png", :alt=> "Place", :class => "place_list_icon") %>
                <div class="place_list_star" id="like_<%= dom_id(place.post_activity) %>">
                  <%= place_star(place.post_activity) %>
                </div>
                <div class="place_list_content">
                  <div class="place_list_name"><%= link_to place.title, place %></div>
                  <div class="place_list_city"><%= place.address.locality %>, <%=place.address.country%></div>
                  <div class="place_list_options">
                    <%= like_place_sentence(place) %>
                  </div>
                </div>
              </div>
          <% end %>
        <% end %>
      <% end %>
    </div>

    <div id="place_map">
      <%= gmaps(:markers     => { :data => @json },
          :map_options => { :auto_adjust => true },
          :last_map    => false) %>
    </div>
  </div>

  <div id="friends" class="roll offscreen">
    <div id="friends_list">
      <% unless @friends.empty? %>
        <% @friends.each do |a| %>
          <% place = a %>
          
          <%= div_for place do %>
              <div class="place_list_item">
                <%= image_tag("place.png", :alt=> "Place", :class => "place_list_icon") %>
                <div class="place_list_star" id="like_<%= dom_id(place.post_activity) %>">
                  <%= place_star(place.post_activity) %>
                </div>
                <div class="place_list_content">
                  <div class="place_list_name"><%= link_to place.title, place %></div>
                  <div class="place_list_city"><%= place.address.locality %>, <%=place.address.country%></div>
                  <div class="place_list_options">
                    <%= like_place_sentence(place) %>
                  </div>
                </div>
              </div>
          <% end %>
        <% end %>
      <% end %>
    </div>

    <div id="friend_map">
      <%= gmaps(:markers     => { :data => @json2 },
          :map_options => { :id => "second_map", :auto_adjust => true },
          :scripts     => :none ) %>
    </div>
  </div>

</div>

<br class="clearfloat" />
<div class="space_center"></div>

<% content_for :scripts do %>
  <script type="text/javascript" charset="utf-8">
    Gmaps.second_map.callback = function() {
      google.maps.event.addListenerOnce(Gmaps.second_map.serviceObject, 'idle', function() {
        $('#friends').toggleClass("hidden offscreen");
      });
    };
  </script>
<% end %>

<%= yield :scripts %>